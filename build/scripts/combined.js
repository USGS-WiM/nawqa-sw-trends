function addCommas(e){e+="";for(var t=e.split("."),a=t[0],i=t.length>1?"."+t[1]:"",r=/(\d+)(\d{3})/;r.test(a);)a=a.replace(r,"$1,$2");return a+i}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers,renderer;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","esri/renderers/UniqueValueRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","dojo/domReady!"],function(e,t,a,i,r,s){var n=null;renderer=new i(n,"all_pest_trends.trend_int");var o=new s(s.STYLE_SQUARE,15,new r(r.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),l=new s(s.STYLE_SQUARE,10,new r(r.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),c=new s(s.STYLE_SQUARE,5,new r(r.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),d=new s(s.STYLE_SQUARE,5,new r(r.STYLE_SOLID,new esri.Color([255,255,255]),1),new esri.Color([0,0,0,.25])),u=new s(s.STYLE_SQUARE,5,new r(r.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25])),p=new s(s.STYLE_SQUARE,10,new r(r.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25])),g=new s(s.STYLE_SQUARE,15,new r(r.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25]));renderer.addValue(3,o),renderer.addValue(2,l),renderer.addValue(1,c),renderer.addValue(0,d),renderer.addValue(-1,u),renderer.addValue(-2,p),renderer.addValue(-3,g),allLayers=[{groupHeading:"sites",showGroupHeading:!1,includeInLayerList:!1,layers:{"pest layer":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites/MapServer/0",options:{id:"pestSites",opacity:1,mode:a.MODE_SNAPSHOT,outFields:["*"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},HUC8:{url:"https://fwsprimary.wim.usgs.gov/server/rest/services/HUCs/MapServer",visibleLayers:[1],options:{id:"huc8",opacity:1,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!1,includeLegend:!0,layerDefinitions:{1:"OBJECTID = -1"}}},"Eco Sites layer":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites/MapServer/1",options:{id:"ecoSites",opacity:1,mode:a.MODE_SNAPSHOT,outFields:["*"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"WRTDS Concentration Sites":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites/MapServer/2",options:{id:"wrtdsSites",opacity:1,mode:a.MODE_SNAPSHOT,outFields:["wrtds_sites.Station_nm","wrtds_sites.Site_no","wrtds_sites.staAbbrev","wrtds_sites.agency1","wrtds_trends_wm_new.agency_1_full","wrtds_trends_wm_new.agency_2_full","wrtds_sites.db_source","wrtds_sites.dec_lat_va","wrtds_sites.dec_long_va","wrtds_sites.drainSqKm","wrtds_sites.huc_cd","wrtds_trends_wm_new.DA"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"WRTDS Flux Sites":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites/MapServer/3",options:{id:"wrtdsFluxSites",opacity:1,mode:a.MODE_SNAPSHOT,outFields:["wrtds_sites.Station_nm","wrtds_sites.Site_no","wrtds_sites.staAbbrev","wrtds_sites.agency1","wrtds_trends_wm_new.agency_1_full","wrtds_trends_wm_new.agency_2_full","wrtds_sites.db_source","wrtds_sites.dec_lat_va","wrtds_sites.dec_long_va","wrtds_sites.drainSqKm","wrtds_sites.huc_cd","wrtds_trends_wm_new.DA"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},2012:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu2012_100515_test/ImageServer",options:{id:"lu2012",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},2002:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu2002_100515_test/ImageServer",options:{id:"lu2002",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1992:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1992_100515_test/ImageServer",options:{id:"lu1992",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1982:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1982_100515_test/ImageServer",options:{id:"lu1982",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1974:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1974_100515_test/ImageServer",options:{id:"lu1974",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}}}}]});var map,allLayers,maxLegendHeight,maxLegendDivHeight,printCount=0,dragInfoWindows=!0,defaultMapCenter=[-94.106,35.729],constObj,currentConstType="",currentSiteNo="",currentConst="Total Phosphorus",currentLayer="wrtdsSites",identifyTask,identifyParams;require(["esri/arcgis/utils","esri/Color","esri/map","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/geometry/Point","esri/graphicsUtils","esri/tasks/IdentifyParameters","esri/tasks/IdentifyTask","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/tasks/LegendLayer","esri/tasks/PrintTask","esri/tasks/PrintParameters","esri/tasks/PrintTemplate","esri/tasks/query","esri/geometry/webMercatorUtils","dojo/dnd/Moveable","dojo/query","dojo/dom","dojo/dom-class","dojo/on","dojo/domReady!"],function(e,t,a,i,r,s,n,o,l,c,d,u,p,g,m,f,y,b,h,v,w,_,S,T,L,x,k,C,P,O){function q(){$("#printModal").modal("show")}function E(){var e="",t=$("input:radio[name='trendPeriod']:checked").val(),a="";"P10"==t?a="2002":"P20"==t?a="1992":"P30"==t?a="1982":"P40"==t&&(a="1972");var i=$("input[name=trendType]:checked").val();i=i.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});var r=$("#typeSelect")[0].value;return"Pesticides"==r||"Nutrients"==r||"Carbon"==r||"Major ions"==r||"Salinity"==r||"Sediment"==r?e=i+" trend results (flow normalized) for "+currentConst+" in surface water for "+a+"-2012":("Algae"==r||"Fish"==r||"Macroinvertebrates"==r)&&(e="Trend results (flow normalized) for "+currentConst+" in surface water for "+a+"-2012"),e}function I(e){var t=map.getLayer(e).on("update-end",function(e){var a=e.target.graphics.length;0==a?$(".alert-box").show():$(".alert-box").hide(),t.remove()});map.getLayer(e).refresh()}function R(){var e=$("#pesticideSelect").val();currentConst=e;var t=$("input[name=trendPeriod]:checked").val(),a="Pesticide = '"+e+"' AND period = '"+t+"'";map.getLayer("pestSites").setDefinitionExpression(a),map.getLayer("pestSites").setVisibility(!0),I("pestSites")}function D(){var e=$($("#typeSelect")[0][$("#typeSelect")[0].selectedIndex].attributes.select.value).val();currentConst=e;var t=$("input[name=trendPeriod]:checked").val(),a="";"P10"==t?a="AND (EcoTrendResults_Nyear = 8 OR EcoTrendResults_Nyear = 9 OR EcoTrendResults_Nyear = 10 OR EcoTrendResults_Nyear = 11)":"P20"==t&&(a="AND (EcoTrendResults_Nyear = 18 OR EcoTrendResults_Nyear = 19 OR EcoTrendResults_Nyear = 20)");var i="EcoTrendResults_y = '"+e+"' "+a;console.log(i),map.getLayer("ecoSites").setDefinitionExpression(""),map.getLayer("ecoSites").setDefinitionExpression(i),map.getLayer("ecoSites").setVisibility(!0),I("ecoSites")}function F(){var e="",t=$("#typeSelect").val(),a=$($("#typeSelect")[0][$("#typeSelect")[0].selectedIndex].attributes.select.value).val();currentConst=a,"Nutrients"==t?e=$("#nutrientsSelect").val():"Carbon"==t?e=$("#carbonSelect").val():"Major ions"==t?e=$("#majorIonsSelect").val():"Salinity"==t?e=$("#salinitySelect").val():"Sediment"==t&&(e=$("#sedimentSelect").val()),"Specific conductance"==e?($("#load").prop("disabled",!0),$("input:radio[name=trendType]")[0].checked=!0):$("#load").prop("disabled",!1);var i,r,s=$("input[name=trendType]:checked").val();"concentration"==s?(i=map.getLayer("wrtdsSites"),r="wrtdsSites",i.setVisibility(!0)):"load"==s&&(i=map.getLayer("wrtdsFluxSites"),r="wrtdsFluxSites",i.setVisibility(!0));var n=$("input[name=trendPeriod]:checked").val(),o="",l="";"P10"==n?(o="2002",l="2003"):"P20"==n?(o="1992",l="1993"):"P30"==n?(o="1982",l="1983"):"P40"==n&&(o="1972",l="1973");var c="wrtds_trends_wm_new.id_unique LIKE '%"+e+"%"+o+"%' OR wrtds_trends_wm_new.id_unique LIKE '%"+e+"%"+l+"%'";i.setDefinitionExpression(c),I(r)}function M(e,t,a,i,r){return new f({angle:0,xoffset:t,yoffset:a,type:"esriPMS",url:e,contentType:"image/png",width:i,height:r})}function N(){function e(e){printCount++;var t=$("<p><label>"+printCount+': </label>&nbsp;&nbsp;<a href="'+e.url+'" target="_blank">'+o+" </a></p>");$("#printJobsDiv").find("p.toRemove").remove(),$("#printModalBody").append(t),$("#printTitle").val(""),$("#printExecuteButton").button("reset")}function t(e){alert("Sorry, an unclear print error occurred. Please try refreshing the application to fix the problem")}var a=new _;a.map=map;var i=new S;i.exportOptions={width:500,height:400,dpi:300},i.format="PDF",i.layout="Letter ANSI A Landscape sw-trends fix",i.preserveScale=!1;var r=new v;r.layerId="1";var s=[],n=E();i.layoutOptions={titleText:n,authorText:"NAWQA",copyrightText:"This page was produced by the nawqa surface water trends mapper",legendLayers:s};var o=i.layoutOptions.titleText;a.template=i;var l=new w("https://gis.wim.usgs.gov/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task");l.execute(a,e,t)}if(!jQuery.support.cors&&window.XDomainRequest){var A=/^https?:\/\//i,j=/^get|post$/i,z=new RegExp("^"+location.protocol,"i"),B=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(e,t,a){if(e.crossDomain&&e.async&&j.test(e.type)&&A.test(t.url)&&z.test(t.url)){var i=null,r=(t.dataType||"").toLowerCase();return{send:function(a,s){i=new XDomainRequest,/^\d+$/.test(t.timeout)&&(i.timeout=t.timeout),i.ontimeout=function(){s(500,"timeout")},i.onload=function(){var e="Content-Length: "+i.responseText.length+"\r\nContent-Type: "+i.contentType,t={code:200,message:"success"},a={text:i.responseText};try{if("json"===r)try{a.json=JSON.parse(i.responseText)}catch(n){t.code=500,t.message="parseerror"}else if("xml"===r||"text"!==r&&B.test(i.contentType)){var o=new ActiveXObject("Microsoft.XMLDOM");o.async=!0;try{o.loadXML(i.responseText)}catch(n){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw t.code=500,t.message="parseerror","Invalid XML: "+i.responseText;a.xml=o}}catch(l){throw l}finally{s(t.code,t.message,a,e)}},i.onerror=function(){s(500,"error",{text:i.responseText})},i.open(e.type,e.url),i.send()},abort:function(){i&&i.abort()}}}})}jQuery.support.cors=!0,$.ajax({dataType:"json",type:"GET",url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites/MapServer/4/query?where=include_in_mapper_+%3D+%27include%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=Model%2CParameter_name&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json",headers:{Accept:"*/*"},success:function(e){constObj=e,$.each(e.features,function(e,t){null!=t.attributes.Model&&("SEAWAVE-Q"==t.attributes.Model?$("#pesticideSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Algae"==t.attributes.Tentative____Parameter_group?$("#algaeSelect").append($("<option title='"+t.attributes.eco_desc+"'></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Fish"==t.attributes.Tentative____Parameter_group?$("#fishSelect").append($("<option title='"+t.attributes.eco_desc+"'></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Macroinvertebrates"==t.attributes.Tentative____Parameter_group?$("#macroinvertSelect").append($("<option title='"+t.attributes.eco_desc+"'></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Carbon"==t.attributes.Tentative____Parameter_group?$("#carbonSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Major ions"==t.attributes.Tentative____Parameter_group?$("#majorIonsSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Nutrients"==t.attributes.Tentative____Parameter_group?$("#nutrientsSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Salinity"==t.attributes.Tentative____Parameter_group?$("#salinitySelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"Sediment"==t.attributes.Tentative____Parameter_group&&$("#sedimentSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)))}),$("#typeSelect").val("Nutrients"),$("#nutrientsSelect").val("Total Phosphorus"),$("#ecologySelect").val("DiaHighMot"),$("#pesticideSelect").val("Acetochlor"),$("#algaeSelect")[0].title=$("#algaeSelect")[0][0].title,$("#fishSelect")[0].title=$("#fishSelect")[0][0].title,$("#macroinvertSelect")[0].title=$("#macroinvertSelect")[0][0].title},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),map=a("mapDiv",{basemap:"topo",center:defaultMapCenter,zoom:5});var G=new i({map:map},"homeButton");G.startup();var V=new r({map:map},"locateButton");V.startup(),$("#legendButton").click(),$(window).resize(function(){}),$("#IEwarnContinue").click(function(){$("#aboutModal").modal({backdrop:"static"}),$("#aboutModal").modal("show")}),-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?$("#IEwarningModal").modal("show"):($("#aboutModal").modal({backdrop:"static"}),$("#aboutModal").modal("show")),$("#printExecuteButton").click(function(e){e.preventDefault(),$(this).button("loading"),N()}),map.on("extent-change",function(e){}),$("#printNavButton").click(function(){var e=$("input:radio[name='trendPeriod']:checked").val(),t="";"P10"==e?t="2002":"P20"==e?t="1992":"P30"==e?t="1982":"P40"==e&&(t="1972");var a=$("input[name=trendType]:checked").val();a=a.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});var i=E();$("#printTitle").text(i),q()});var H=["pestSites","ecoSites","wrtdsSites","wrtdsFluxSites"];$("#typeSelect").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value;$(".constSelect").hide(),$.each(H,function(e,t){map.getLayer(t).setVisibility(!1)}),("Pesticides"==t||"Algae"==t||"Fish"==t||"Macroinvertebrates"==t)&&($("#trend1input").checked||$("#trend2input").checked||$("#trend1input").prop("checked",!0));var a=e.currentTarget[e.currentTarget.selectedIndex].attributes.select.value;$(a).show(),currentConst=a,"Nutrients"==t||"Carbon"==t||"Major ions"==t||"Salinity"==t||"Sediment"==t?($("#trendTypes").show(),$("#trend4,#trend3").show(),F()):"Pesticides"==t?($("#trendTypes").show(),$("#trend4,#trend3").hide(),$("#load").prop("disabled",!1),R()):("Algae"==t||"Fish"==t||"Macroinvertebrates"==t)&&($("#trendTypes").hide(),$("#trend4,#trend3").hide(),$("#load").prop("disabled",!1),D())}),$("#pesticideSelect").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value;currentConst=t;var a=$("input[name=trendPeriod]:checked").val(),i="Pesticide = '"+t+"' AND period = '"+a+"'";map.getLayer("pestSites").setDefinitionExpression(i),I("pestSites")}),$(".ecoSelect").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value;e.currentTarget.title=e.currentTarget[e.currentTarget.selectedIndex].title,currentConst=t;var a=$("input[name=trendPeriod]:checked").val(),i="";"P10"==a?i="AND (EcoTrendResults_Nyear  = 8 OR EcoTrendResults_Nyear  = 9 OR EcoTrendResults_Nyear  = 10 OR EcoTrendResults_Nyear  = 11)":"P20"==a&&(i="AND (EcoTrendResults_Nyear  = 18 OR EcoTrendResults_Nyear  = 19 OR EcoTrendResults_Nyear  = 20)");var r="EcoTrendResults_y = '"+t+"' "+i;map.getLayer("ecoSites").setDefinitionExpression(r),I("ecoSites")}),$(".wrtdsSelect").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value;currentConst=t;var a,i;"Specific conductance"==t?($("#load").prop("disabled",!0),$("input:radio[name=trendType]")[0].checked=!0):$("#load").prop("disabled",!1);var r=$("input[name=trendType]:checked").val();"concentration"==r?(a=map.getLayer("wrtdsSites"),i="wrtdsSites",a.setVisibility(!0)):"load"==r&&(a=map.getLayer("wrtdsFluxSites"),i="wrtdsFluxSites",a.setVisibility(!0));var s=$("input[name=trendPeriod]:checked").val(),n="",o="";"P10"==s?(n="2002",o="2003"):"P20"==s?(n="1992",o="1993"):"P30"==s?(n="1982",o="1983"):"P40"==s&&(n="1972",o="1973");var l="wrtds_trends_wm_new.id_unique LIKE '%"+t+"%"+n+"%' OR wrtds_trends_wm_new.id_unique LIKE '%"+t+"%"+o+"%'";a.setDefinitionExpression(l),I(i)}),$(".trendPeriod").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value,a=$($("#typeSelect")[0][$("#typeSelect")[0].selectedIndex].attributes.select.value).val();if("Pesticides"==$("#typeSelect")[0].value){var a=$("#pesticideSelect").val();currentConst=a;var i="Pesticide = '"+a+"' AND period = '"+t+"'";map.getLayer("pestSites").setDefinitionExpression(i),I("pestSites")}else if("Algae"==$("#typeSelect")[0].value||"Fish"==$("#typeSelect")[0].value||"Macroinvertebrates"==$("#typeSelect")[0].value){var r="";currentConst=a,"P10"==t?r="AND (EcoTrendResults_Nyear  = 8 OR EcoTrendResults_Nyear  = 9 OR EcoTrendResults_Nyear  = 10 OR EcoTrendResults_Nyear  = 11)":"P20"==t&&(r="AND (EcoTrendResults_Nyear  = 18 OR EcoTrendResults_Nyear  = 19 OR EcoTrendResults_Nyear  = 20)");var i="EcoTrendResults_y = '"+a+"' "+r;console.log(i),map.getLayer("ecoSites").setDefinitionExpression(i),I("ecoSites")}else if("Nutrients"==$("#typeSelect")[0].value||"Carbon"==$("#typeSelect")[0].value||"Major ions"==$("#typeSelect")[0].value||"Salinity"==$("#typeSelect")[0].value||"Sediment"==$("#typeSelect")[0].value){var s,n,o=$("input[name=trendType]:checked").val();"concentration"==o?(s=map.getLayer("wrtdsSites"),n="wrtdsSites",s.setVisibility(!0),map.getLayer("wrtdsFluxSites").setVisibility(!1)):"load"==o&&(s=map.getLayer("wrtdsFluxSites"),n="wrtdsFluxSites",s.setVisibility(!0),map.getLayer("wrtdsSites").setVisibility(!1));var r="",l="";"P10"==t?(r="2002",l="2003"):"P20"==t?(r="1992",l="1993"):"P30"==t?(r="1982",l="1983"):"P40"==t&&(r="1972",l="1973");var a=$($("#typeSelect")[0][$("#typeSelect")[0].selectedIndex].attributes.select.value).val();currentConst=a;var i="wrtds_trends_wm_new.id_unique LIKE '%"+a+"%"+r+"%' OR wrtds_trends_wm_new.id_unique LIKE '%"+a+"%"+l+"%'";s.setDefinitionExpression(i),I(n)}}),$(".trendType").on("change",function(e){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var t=e.currentTarget.value,a=$($("#typeSelect")[0][$("#typeSelect")[0].selectedIndex].attributes.select.value).val();if("Pesticides"==$("#typeSelect")[0].value);else if("Algae"==$("#typeSelect")[0].value||"Fish"==$("#typeSelect")[0].value||"Macroinvertebrates"==$("#typeSelect")[0].value);else if("Nutrients"==$("#typeSelect")[0].value||"Carbon"==$("#typeSelect")[0].value||"Major ions"==$("#typeSelect")[0].value||"Salinity"==$("#typeSelect")[0].value||"Sediment"==$("#typeSelect")[0].value){var i,r;$.each(H,function(e,t){map.getLayer(t).setVisibility(!1)}),"concentration"==t?(i=map.getLayer("wrtdsSites"),r="wrtdsSites"):"load"==t&&(i=map.getLayer("wrtdsFluxSites"),r="wrtdsFluxSites");var s=$("input[name=trendPeriod]:checked").val(),n="",o="";"P10"==s?(n="2002",o="2003"):"P20"==s?(n="1992",o="1993"):"P30"==s?(n="1982",o="1983"):"P40"==s&&(n="1972",o="1973"),currentConst=a;var l="wrtds_trends_wm_new.id_unique LIKE '%"+a+"%"+n+"%' OR wrtds_trends_wm_new.id_unique LIKE '%"+a+"%"+o+"%'";i.setDefinitionExpression(l),i.setVisibility(!0),I(r)}}),O(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var t=L.webMercatorToGeographic(map.extent.getCenter());if($("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3)),1==dragInfoWindows){var a=k(".title",map.infoWindow.domNode)[0],i=new x(map.infoWindow.domNode,{handle:a});O(i,"FirstMove",function(){var e=k(".outerPointer",map.infoWindow.domNode)[0];P.add(e,"hidden");var e=k(".pointer",map.infoWindow.domNode)[0];P.add(e,"hidden")}.bind(this))}}),O(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),O(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var t=L.webMercatorToGeographic(e.mapPoint);$("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3))}}),O(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=L.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var U=new n("https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");O(C.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(U)}),O(C.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(U)}),O(C.byId("btnHybrid"),"click",function(){map.setBasemap("hybrid"),map.removeLayer(U)}),O(C.byId("btnTerrain"),"click",function(){map.setBasemap("terrain"),map.removeLayer(U)}),O(C.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(U)}),O(C.byId("btnNatGeo"),"click",function(){map.setBasemap("national-geographic"),map.removeLayer(U)}),O(C.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(U)}),O(C.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(U)}),O(C.byId("btnNatlMap"),"click",function(){map.addLayer(U)}),O(map,"click",function(e){}),$("#siteInfoDiv").lobiPanel({unpin:!1,reload:!1,minimize:!1,close:!1,expand:!1,editTitle:!1,maxWidth:800,maxHeight:500}),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoClose' title='close'><b>X</b></div>"),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoMin' title='collapse'><b>_</b></div>"),$("#siteInfoMin").click(function(){$("#siteInfoDiv").css("visibility","hidden")}),$("#siteInfoClose").click(function(){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear();var e;e=map.getLayer("huc8"),e.setVisibility(!1)});var W="";map.on("layer-add",function(e){var a=e.layer.id;e.layer;if("pestSites"==a||"wrtdsSites"==a||"ecoSites"==a||"wrtdsFluxSites"==a){if("wrtdsSites"==a){map.getLayer("wrtdsSites").graphics;map.getLayer("wrtdsSites").setDefinitionExpression("wrtds_trends_wm_new.id_unique LIKE '%Total Phosphorus%2002' OR wrtds_trends_wm_new.id_unique LIKE '%Total Phosphorus%2003'"),map.getLayer("wrtdsSites").setVisibility(!0)}map.getLayer(a).on("click",function(e){var i;i=map.getLayer("huc8"),i.setVisibility(!0),map.graphics.clear();var r=new h;r.setStyle(h.STYLE_SQUARE),r.setColor(new t([0,0,0,0])),r.setSize("20");var s=new b(b.STYLE_SOLID,new t([0,255,255]),2);r.setOutline(s);var n=(new u(e.mapPoint.x,e.mapPoint.y,map.spatialReference),new c(e.graphic.geometry,r));map.graphics.add(n);var o=new g;o.returnGeometry=!0,o.tolerance=0,o.width=map.width,o.height=map.height,o.geometry=e.graphic.geometry,o.layerOption=g.LAYER_OPTION_TOP,o.mapExtent=map.extent,o.spatialReference=map.spatialReference;var l=new m(allLayers[0].layers.HUC8.url),d=l.execute(o);d.addCallback(function(e){if(e.length>=1){var t;t=e[0].feature;var a=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,255,0]),2),new dojo.Color([98,194,204,0]));t.geometry.spatialReference=map.spatialReference;var i=t;i.setSymbol(a),map.graphics.add(i);var r=L.webMercatorToGeographic(t.geometry),s=r.getExtent();map.setExtent(s,!0);e[0].feature.attributes.HUC8,e[0].feature.attributes.Name}}),"ecoSites"==a?$("#charts").hide():$("#charts").show(),$("#siteInfoDiv").css("visibility","visible");var p=$("#siteInfoDiv").data("lobiPanel"),f=$(document).height(),y=$(document).width(),v=.9,w=f*v,_=y*v;500>f&&$("#siteInfoDiv").height(w),500>y&&$("#siteInfoDiv").width(_);var S=e.x,T=e.y;p.setPosition(S,T),1==p.isPinned()&&p.unpin();var x=e.graphic.attributes;if($("#siteInfoTabPane").empty(),currentLayer=a,"ecoSites"==a)currentSiteNo=x.EcoTrendResults_EcoSiteID,$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+x.EcoSiteSummary_no_headers_csv_Ecology_site_name+"<br/><b>Site number: </b>"+x.EcoTrendResults_EcoSiteID+"<br/><b>Agency: </b>U.S. Geological Survey<br/><b>Data source: </b>BioData<br/><b>Latitude: </b>"+x.EcoSiteSummary_no_headers_csv_LatDD+"<br/><b>Longitude: </b>"+x.EcoSiteSummary_no_headers_csv_LngDD+"<br/><b>Drainage area: </b>"+x.DA+" (km<sup>2</sup>)<br/>");else if("pestSites"==a){currentSiteNo=x.pstaid,$("#siteInfoTabPane #charts").click(function(e){console.log("event"+e.toString())});var k="";"P10"==x.period?k="results10":"P20"==x.period&&(k="results20");var C=x.pname;4==C.length&&(C="0"+C),W="https://wim.usgs.gov/sw-trends-data/pest_charts/"+k+"/"+x.period+"_"+x.pstaid+"_FinalRun"+C+".pdf",$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+x.Site+"<br/><b>Site number: </b>"+x.pstaid+"<br/><b>Agency: </b>U.S. Geological Survey<br/><b>Data source: </b>NWIS<br/><b>Latitude: </b>"+x.LAT+"<br/><b>Longitude: </b>"+x.LONG_+"<br/><b>Drainage area: </b>"+x.DA+" (km<sup>2</sup>)<br/>")}else if("wrtdsSites"==a||"wrtdsFluxSites"==a){currentSiteNo=x["wrtds_sites.Site_no"];var P="";P=null==x["wrtds_trends_wm_new.agency_2_full"]?x["wrtds_trends_wm_new.agency_1_full"]:x["wrtds_trends_wm_new.agency_1_full"]+"/"+x["wrtds_trends_wm_new.agency_2_full"],$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+x["wrtds_sites.Station_nm"]+"<br/><b>Site number: </b>"+x["wrtds_sites.Site_no"]+"<br/><b>State: </b>"+x["wrtds_sites.staAbbrev"]+"<br/><b>Agency: </b>"+P+"<br/><b>Data source: </b>"+x["wrtds_sites.db_source"]+"<br/><b>Latitude: </b>"+x["wrtds_sites.dec_lat_va"]+"<br/><b>Longitude: </b>"+x["wrtds_sites.dec_long_va"]+"<br/><b>Drainage area: </b>"+x["wrtds_trends_wm_new.DA"]+" (km<sup>2</sup>)<br/>")}})}("wrtdsSites"==a||"wrtdsFluxSites"==a)&&map.getLayer(a).on("query-limit-exceeded",function(e){alert("exceeded")})}),search_api.create("geosearch",{on_result:function(e){require(["esri/geometry/Extent"],function(t){var a=["GNIS_MAJOR","GNIS_MINOR","ZIPCODE","AREACODE"],i=a.indexOf(e.result.properties.Source);$("#geosearchModal").modal("hide"),-1==i?map.setExtent(new esri.geometry.Extent({xmin:e.result.properties.LonMin,ymin:e.result.properties.LatMin,xmax:e.result.properties.LonMax,ymax:e.result.properties.LatMax,spatialReference:{wkid:4326}}),!0):require(["esri/geometry/Point"],function(t){map.centerAndZoom(new t(e.result.properties.Lon,e.result.properties.Lat),12)})})},include_usgs_sw:!0,include_usgs_gw:!0,include_usgs_sp:!0,include_usgs_at:!0,include_usgs_ot:!0,include_huc2:!0,include_huc4:!0,include_huc6:!0,include_huc8:!0,include_huc10:!0,include_huc12:!0});M("../images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}function a(){if("pestSites"==currentLayer)window.open(W,"_blank");else{$(".charts-sbdown").hide(),$(".charts-model-loading").hide(),$("#pConc").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/plotConcTime.png"),$("#bConc").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/boxConcMonth.png"),$("#pConcPred").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/plotConcPred.png"),$("#pFluxPred").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/plotFluxPred.png"),$("#pConcHistBoot").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/plotConcHistBoot.png"),$("#pFluxHistBoot").attr("src","https://s3.amazonaws.com/nawqatrends.wim.usgs.gov/charts/"+currentConst+"_"+currentSiteNo+"/plotFluxHistBoot.png"),$("#chartModal").modal("show")}}function i(){function e(e){for(var t=Number(e),a=[1972,1982,1992,2002],i=50,r=0,s=0;s<a.length;s++){var n=Math.abs(a[s]-t);i>n&&(r=s,i=n)}var o=a[r],l=o.toString();return l}$("#tableModal").modal("show"),$("#tableDiv").html("Loading ..."),0==isNaN(currentSiteNo)&&currentSiteNo.toString().length<8&&(currentSiteNo="0"+currentSiteNo);var t=$.ajax({dataType:"json",type:"GET",url:map.getLayer("wrtdsSites").url+"/query?where=wrtds_trends_wm_new.Site_no+%3D+%27"+currentSiteNo+"%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=wrtds_trends_wm_new.param_nm%2Cwrtds_trends_wm_new.id_unique%2Cwrtds_trends_wm_new.likeC%2C+wrtds_trends_wm_new.likeF%2Cwrtds_trends_wm_new.trend_pct_C%2Cwrtds_trends_wm_new.trend_pct_F%2Cwrtds_trends_wm_new.low_int_C%2Cwrtds_trends_wm_new.low_int_F%2Cwrtds_trends_wm_new.up_int_C%2Cwrtds_trends_wm_new.up_int_F%2Cwrtds_trends_wm_new.estC%2Cwrtds_trends_wm_new.estF%2Cwrtds_trends_wm_new.lowC90%2Cwrtds_trends_wm_new.lowF90%2Cwrtds_trends_wm_new.upC90%2Cwrtds_trends_wm_new.upF90&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=true&resultOffset=&resultRecordCount=&f=json",headers:{Accept:"*/*"}}),a=$.ajax({dataType:"json",type:"GET",url:map.getLayer("pestSites").url+"/query?where=pstaid+%3D+%27"+currentSiteNo+"%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=Pesticide%2Cperiod%2Cc_map_lklhd%2CctndPpor%2CclciPpor%2CcuciPpor%2CctndOrigPORPercentBase%2CclciOrigPORPercentBase%2CcuciOrigPORPercentBase%2CltndPpor%2CluciPpor%2CllciPpor%2CltndOrigPORPercentBase%2CluciOrigPORPercentBase%2CllciOrigPORPercentBase&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json",headers:{Accept:"*/*"}}),i=$.ajax({dataType:"json",type:"GET",url:map.getLayer("ecoSites").url+"/query?where=EcoTrendResults_EcoSiteID+%3D+%27"+currentSiteNo+"%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=EcoTrendResults_y%2CEcoTrendResults_firstYear%2CEcoTrendResults_likelihood%2CEcoTrendResults_Per_ChangeR%2Ctrend_orig_period%2Ccode_desc&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json",
headers:{Accept:"*/*"}});$.when(t,a,i).done(function(t,a,i){var r=[];$.each(t[0].features,function(t,a){var i=a.attributes["wrtds_trends_wm_new.id_unique"].split("_"),s=i[i.length-1];r.push([a.attributes["wrtds_trends_wm_new.param_nm"],"Concentration (flow normalized)",e(s)+"-2012",Math.abs(a.attributes["wrtds_trends_wm_new.likeC"].toFixed(3)),a.attributes["wrtds_trends_wm_new.trend_pct_C"].toFixed(2),a.attributes["wrtds_trends_wm_new.low_int_C"].toFixed(2),a.attributes["wrtds_trends_wm_new.up_int_C"].toFixed(2),a.attributes["wrtds_trends_wm_new.estC"].toFixed(4),a.attributes["wrtds_trends_wm_new.lowC90"].toFixed(4),a.attributes["wrtds_trends_wm_new.upC90"].toFixed(4),"90 percent confidence interval"]),"Specific conductance"!=a.attributes["wrtds_trends_wm_new.param_nm"]&&r.push([a.attributes["wrtds_trends_wm_new.param_nm"],"Load (flow normalized)",e(s)+"-2012",Math.abs(a.attributes["wrtds_trends_wm_new.likeF"].toFixed(3)),a.attributes["wrtds_trends_wm_new.trend_pct_F"].toFixed(2),a.attributes["wrtds_trends_wm_new.low_int_F"].toFixed(2),a.attributes["wrtds_trends_wm_new.up_int_F"].toFixed(2),a.attributes["wrtds_trends_wm_new.estF"].toFixed(4),a.attributes["wrtds_trends_wm_new.lowF90"].toFixed(4),a.attributes["wrtds_trends_wm_new.upF90"].toFixed(4),"90 percent confidence interval"])}),$.each(a[0].features,function(e,t){var a="";"P20"==t.attributes.period?a="1992-2012":"P10"==t.attributes.period&&(a="2002-2012"),r.push([t.attributes.Pesticide,"Concentration (flow normalized)",a,Math.abs(t.attributes.c_map_lklhd.toFixed(3)),t.attributes.ctndPpor.toFixed(2),t.attributes.clciPpor.toFixed(2),t.attributes.cuciPpor.toFixed(2),t.attributes.ctndOrigPORPercentBase.toFixed(4),t.attributes.clciOrigPORPercentBase.toFixed(4),t.attributes.cuciOrigPORPercentBase.toFixed(4),"90 percent confidence interval"]),r.push([t.attributes.Pesticide,"Load (flow normalized)",a,Math.abs(t.attributes.c_map_lklhd.toFixed(3)),t.attributes.ltndPpor.toFixed(2),t.attributes.llciPpor.toFixed(2),t.attributes.luciPpor.toFixed(2),t.attributes.ltndOrigPORPercentBase.toFixed(4),t.attributes.llciOrigPORPercentBase.toFixed(4),t.attributes.luciOrigPORPercentBase.toFixed(4),"90 percent confidence interval"])}),$.each(i[0].features,function(t,a){r.push([a.attributes.code_desc,"Metric (flow normalized)",e(a.attributes.EcoTrendResults_firstYear)+"-2012",Math.abs(a.attributes.EcoTrendResults_likelihood.toFixed(3)),a.attributes.EcoTrendResults_Per_ChangeR.toFixed(2),"Not available","Not available","Not available","Not available","Not available","Not available"])}),$("#tableDiv").html("");var s=document.getElementById("tableDiv"),n=new Handsontable(s,{data:r,rowHeaders:!1,colHeaders:!0,manualColumnResize:!0}),o=[["Constituent","Type","Trend period","Trend likelihood","Trend, in percent","Lower confidence interval on the trend, in percent","Upper confidence interval on the trend, in percent","Trend, in original units","Lower confidence interval on the trend, in orginal units","Upper confidence interval on the trend, in original units","Reported confidence interval"]];n.updateSettings({colHeaders:["Constituent","Type","Trend period","Trend likelihood","Trend, in percent","Lower confidence interval on the trend, in percent","Upper confidence interval on the trend, in percent","Trend, in original units","Lower confidence interval on the trend, in original units","Upper confidence interval on the trend, in original units","Reported confidence interval"],colWidths:[200,110,80,80,80,125,125,100,125,125,100],readOnly:!0,columnSorting:!0,sortIndicator:!0});var l=$(".download-table-btn").on("click",function(e){var t="data:text/csv;charset=utf-8,";o.forEach(function(e,a){var i=e.join('","');t+=a<r.length?'"'+i+'"\r\n':i});r.forEach(function(e,a){var i="";e.forEach(function(e,t){i+=0==t?'"'+e+'"':","+e}),t+=a<r.length?i+"\r\n":i});var a=encodeURI(t);if(-1!=navigator.userAgent.indexOf("Safari")){var i=document.createEvent("MouseEvent");i.initEvent("click",!0,!0);var s=$("<a>").attr("id","downloadLink").attr("target","_blank").attr("href",a).attr("download",currentSiteNo+"_trend_results.csv").appendTo("body"),n=document.getElementById("downloadLink");n.dispatchEvent(i),s.remove()}else{var l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download",currentSiteNo+"_trend_results.csv"),document.body.appendChild(l),l.click(),l.remove()}});$(".table-close").click(function(){l.off()})}).fail(function(){alert("there was a problem")})}$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$(".showUserGuide").click(function(){$("#searchTab").trigger("click"),$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show")}),$(".showUserGuide2").click(function(){$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show"),$("#iconTab").trigger("click"),console.log("Opening tab 2 user guide")}),$(".showUserGuide3").click(function(){$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show"),console.log("Opening tab 3 user guide"),$("#layersTab").trigger("click")}),$("#userGuideNav").click(function(){$("#userGuideModal").modal("show"),$("#searchTab").trigger("click")}),$("#trendResultHelp").click(function(){$("#trendResultsHelpBox").slideToggle(200)}),$("#faqNav").click(function(){$("#faqModal").modal("show")}),$("#charts").click(function(){a()}),$("#table").click(function(){$("#tableModal").modal({backdrop:"static",keyboard:!1}),i()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")}),$("#faq1header").click(function(){$("#faq1body").slideToggle(250)}),$("#faq2header").click(function(){$("#faq2body").slideToggle(250)}),$("#faq3header").click(function(){$("#faq3body").slideToggle(250)}),$("#faq4header").click(function(){$("#faq4body").slideToggle(250)}),$("#faq5header").click(function(){$("#faq5body").slideToggle(250)}),$("#faq6header").click(function(){$("#faq6body").slideToggle(250)}),$("#faq7header").click(function(){$("#faq7body").slideToggle(250)}),$("#faq8header").click(function(){$("#faq8body").slideToggle(250)}),$("#faq9header").click(function(){$("#faq9body").slideToggle(250)}),$("#faq10header").click(function(){$("#faq10body").slideToggle(250)}),$("#faq11header").click(function(){$("#faq11body").slideToggle(250)}),$("#faq12header").click(function(){$("#faq12body").slideToggle(250)}),$("#faq13header").click(function(){$("#faq13body").slideToggle(250)}),$("#faq14header").click(function(){$("#faq14body").slideToggle(250)}),$("#faq15header").click(function(){$("#faq15body").slideToggle(250)}),$("#faq16header").click(function(){$("#faq16body").slideToggle(250)}),$("#faq17header").click(function(){$("#faq17body").slideToggle(250)}),$("#faq18header").click(function(){$("#faq18body").slideToggle(250)}),$("#faq19header").click(function(){$("#faq19body").slideToggle(250)}),$("#faq20header").click(function(){$("#faq20body").slideToggle(250)}),$("#faq21header").click(function(){$("#faq21body").slideToggle(250)}),$("#faq22header").click(function(){$("#faq22body").slideToggle(250)}),$("#faq23header").click(function(){$("#faq23body").slideToggle(250)}),$("#faq24header").click(function(){$("#faq24body").slideToggle(250)}),$("#faq25header").click(function(){$("#faq25body").slideToggle(250)}),$("#faq26header").click(function(){$("#faq26body").slideToggle(250)}),$("#faq27header").click(function(){$("#faq27body").slideToggle(250)}),$("#faq28header").click(function(){$("#faq28body").slideToggle(250)}),$(".fullsize").click(function(){var e=window.open($(this).attr("src"),"_blank");e.focus()}),$("#faq1header").click(function(){"none"==$("#angle1").css("transform")?$("#angle1").css("transform","rotate(90deg)"):$("#angle1").css("transform","")}),$("#faq2header").click(function(){"none"==$("#angle2").css("transform")?$("#angle2").css("transform","rotate(90deg)"):$("#angle2").css("transform","")}),$("#faq3header").click(function(){"none"==$("#angle3").css("transform")?$("#angle3").css("transform","rotate(90deg)"):$("#angle3").css("transform","")}),$("#faq4header").click(function(){"none"==$("#angle4").css("transform")?$("#angle4").css("transform","rotate(90deg)"):$("#angle4").css("transform","")}),$("#faq5header").click(function(){"none"==$("#angle5").css("transform")?$("#angle5").css("transform","rotate(90deg)"):$("#angle5").css("transform","")}),$("#faq6header").click(function(){"none"==$("#angle6").css("transform")?$("#angle6").css("transform","rotate(90deg)"):$("#angle6").css("transform","")}),$("#faq7header").click(function(){"none"==$("#angle7").css("transform")?$("#angle7").css("transform","rotate(90deg)"):$("#angle7").css("transform","")}),$("#faq8header").click(function(){"none"==$("#angle8").css("transform")?$("#angle8").css("transform","rotate(90deg)"):$("#angle8").css("transform","")}),$("#faq9header").click(function(){"none"==$("#angle9").css("transform")?$("#angle9").css("transform","rotate(90deg)"):$("#angle9").css("transform","")}),$("#faq10header").click(function(){"none"==$("#angle10").css("transform")?$("#angle10").css("transform","rotate(90deg)"):$("#angle10").css("transform","")}),$("#faq11header").click(function(){"none"==$("#angle11").css("transform")?$("#angle11").css("transform","rotate(90deg)"):$("#angle11").css("transform","")}),$("#faq12header").click(function(){"none"==$("#angle12").css("transform")?$("#angle12").css("transform","rotate(90deg)"):$("#angle12").css("transform","")}),$("#faq13header").click(function(){"none"==$("#angle13").css("transform")?$("#angle13").css("transform","rotate(90deg)"):$("#angle13").css("transform","")}),$("#faq14header").click(function(){"none"==$("#angle14").css("transform")?$("#angle14").css("transform","rotate(90deg)"):$("#angle14").css("transform","")}),$("#faq15header").click(function(){"none"==$("#angle15").css("transform")?$("#angle15").css("transform","rotate(90deg)"):$("#angle15").css("transform","")}),$("#faq16header").click(function(){"none"==$("#angle16").css("transform")?$("#angle16").css("transform","rotate(90deg)"):$("#angle16").css("transform","")}),$("#faq17header").click(function(){"none"==$("#angle17").css("transform")?$("#angle17").css("transform","rotate(90deg)"):$("#angle17").css("transform","")}),$("#faq18header").click(function(){"none"==$("#angle18").css("transform")?$("#angle18").css("transform","rotate(90deg)"):$("#angle18").css("transform","")}),$("#faq19header").click(function(){"none"==$("#angle19").css("transform")?$("#angle19").css("transform","rotate(90deg)"):$("#angle19").css("transform","")}),$("#faq20header").click(function(){"none"==$("#angle20").css("transform")?$("#angle20").css("transform","rotate(90deg)"):$("#angle20").css("transform","")}),$("#faq21header").click(function(){"none"==$("#angle21").css("transform")?$("#angle21").css("transform","rotate(90deg)"):$("#angle21").css("transform","")}),$("#faq22header").click(function(){"none"==$("#angle22").css("transform")?$("#angle22").css("transform","rotate(90deg)"):$("#angle22").css("transform","")}),$("#faq23header").click(function(){"none"==$("#angle23").css("transform")?$("#angle23").css("transform","rotate(90deg)"):$("#angle23").css("transform","")}),$("#faq24header").click(function(){"none"==$("#angle24").css("transform")?$("#angle24").css("transform","rotate(90deg)"):$("#angle24").css("transform","")}),$("#faq25header").click(function(){"none"==$("#angle25").css("transform")?$("#angle25").css("transform","rotate(90deg)"):$("#angle25").css("transform","")}),$("#faq26header").click(function(){"none"==$("#angle26").css("transform")?$("#angle26").css("transform","rotate(90deg)"):$("#angle26").css("transform","")}),$("#faq27header").click(function(){"none"==$("#angle27").css("transform")?$("#angle27").css("transform","rotate(90deg)"):$("#angle27").css("transform","")}),$("#faq28header").click(function(){"none"==$("#angle28").css("transform")?$("#angle28").css("transform","rotate(90deg)"):$("#angle28").css("transform","")})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/SpatialReference","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","dijit/form/CheckBox","dijit/form/RadioButton","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on"],function(e,t,a,i,r,n,o,l,c,d,u,p,g,m,f,y,b,h,v,w){function _(e,t,a,i,r,s,n){if(map.addLayer(a),T.push([r,camelize(i),a]),r){if(!$("#"+camelize(r)).length){var o;if("Data Source"==r)var o=$('<div id="'+camelize(r+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+r+'<span id="info'+camelize(r)+'" title="Data Source identifies the scale, year and emulsion of the imagery that was used to map the wetlands and riparian areas for a given area. It also identifies areas that have Scalable data, which is an interim data product in areas of the nation where standard compliant wetland data is not yet available. Click for more info on Scalable data." class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(r)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button> </div>');else var o=$('<div id="'+camelize(r+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+r+"</button> </div>");o.click(function(e){o.find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$.each(T,function(e,t){var a=map.getLayer(t[2].id);if(t[0]==r)if($("#"+t[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&o.find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",t[1]),map.addLayer(t[2]);var a=map.getLayer(t[2].id);a.setVisibility(!0)}else if(o.find("i.glyphspan").hasClass("fa-square-o")){console.log("removing layer: ",t[1]);var a=map.getLayer(t[2].id);a.setVisibility(!1)}})});var l=$('<div id="'+camelize(r)+'" class="btn-group-vertical" data-toggle="buttons"></div>');$("#toggle").append(l),console.log("here")}if(a.visible)var c=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(r)+'" autocomplete="off"><i class="glyphspan fa fa-dot-circle-o '+camelize(r)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");else var c=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(r)+'" autocomplete="off"><i class="glyphspan fa fa-circle-o '+camelize(r)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");$("#"+camelize(r)).append(c),c.click(function(e){if($(this).find("i.glyphspan").hasClass("fa-circle-o")){$(this).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o");var t=$(this)[0].id;$.each(T,function(e,a){if(a[0]==r)if(a[1]==t&&$("#"+camelize(r+" Root")).find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",a[1]),map.addLayer(a[2]);var i=map.getLayer(a[2].id);i.setVisibility(!0)}else if(a[1]==t&&$("#"+camelize(r+" Root")).find("i.glyphspan").hasClass("fa-square-o"))console.log("group heading not checked");else{console.log("removing layer: ",a[1]);var i=map.getLayer(a[2].id);i.setVisibility(!1),$("#"+a[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&$("#"+a[1]).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o")}})}})}else if(n.includeInLayerList){if(a.visible&&void 0!==n.hasOpacitySlider&&1==n.hasOpacitySlider&&void 0!==n.moreinfo&&n.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="info'+camelize(i)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(i)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(!a.visible&&void 0!==n.hasOpacitySlider&&1==n.hasOpacitySlider&&void 0!==n.moreinfo&&n.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="info'+camelize(i)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(i)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(a.visible&&void 0!==n.hasOpacitySlider&&1==n.hasOpacitySlider)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="info'+camelize(i)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(a.visible||void 0===n.hasOpacitySlider||1!=n.hasOpacitySlider)if(a.visible&&void 0!==n.moreinfo&&n.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');else if(!a.visible&&void 0!==n.moreinfo&&n.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="info'+camelize(i)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(a.visible)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+"</button></span></div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+"</button> </div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');c.click(function(e){$(this).find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$(this).find("button").button("toggle"),a.visible?a.setVisibility(!1):a.setVisibility(!0),n.otherLayersToggled&&$.each(n.otherLayersToggled,function(e,t){var i=map.getLayer(t);i.setVisibility(a.visible)})})}if(void 0!==t){var d=camelize(e);if(!$("#"+d).length){if(t)var u=$('<div id="'+d+'"><div class="alert alert-info" role="alert"><strong>'+e+"</strong></div></div>");else var u=$('<div id="'+d+'"></div>');$("#toggle").append(u)}if(r){if($("#"+d).append(o),$("#"+d).append(l),void 0!==n.moreinfo&&n.moreinfo){var p="#info"+camelize(r),g=$(p);g.click(function(e){window.open(n.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}if($("#opacity"+camelize(r)).length>0){var p="#opacity"+camelize(r),m=$(p);m.click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var t=map.getLayer(s.id).opacity,a=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+t+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(a),$("#slider")[0].value=100*t,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(s.id).setOpacity(t),n.otherLayersToggled&&$.each(n.otherLayersToggled,function(e,a){var i=map.getLayer(a);i.setOpacity(t)})})})}}else{if($("#"+d).append(c),void 0!==n.moreinfo&&n.moreinfo){var p="#info"+camelize(i),g=$(p);g.click(function(e){window.open(n.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}$("#opacity"+camelize(i)).length>0&&$("#opacity"+camelize(i)).click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var t=map.getLayer(s.id).opacity,a=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+t+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(a),$("#slider")[0].value=100*t,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(s.id).setOpacity(t),n.otherLayersToggled&&$.each(n.otherLayersToggled,function(e,a){var i=map.getLayer(a);i.setOpacity(t)})})})}}else if($("#toggle").append(c),void 0!==n.moreinfo&&n.moreinfo){var p="#info"+camelize(i),g=$(p);g.click(function(e){alert(e.currentTarget.id),e.preventDefault(),e.stopPropagation()})}}var S=[],T=[];$.each(allLayers,function(e,t){console.log("processing: ",t.groupHeading),$.each(t.layers,function(e,a){var i=e;("pest layer"==i||"Eco Sites layer"==i||"WRTDS Concentration Sites"==i||"WRTDS Flux Sites"==i)&&(i="Trend results");var r="";if(a.wimOptions.exclusiveGroupName&&(r=a.wimOptions.exclusiveGroupName),"agisFeature"===a.wimOptions.layerType){var n=new c(a.url,a.options);void 0!==a.wimOptions.renderer&&n.setRenderer(a.wimOptions.renderer),a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:n,title:i}),_(t.groupHeading,t.showGroupHeading,n,e,r,a.options,a.wimOptions)}else if("agisWMS"===a.wimOptions.layerType){var n=new u(a.url,{resourceInfo:a.options.resourceInfo,visibleLayers:a.options.visibleLayers},a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:n,title:i}),_(t.groupHeading,t.showGroupHeading,n,e,r,a.options,a.wimOptions)}else if("agisDynamic"===a.wimOptions.layerType){var n=new l(a.url,a.options);if(a.visibleLayers&&n.setVisibleLayers(a.visibleLayers),a.wimOptions&&a.wimOptions.layerDefinitions){var o=[];$.each(a.wimOptions.layerDefinitions,function(e,t){o[e]=t}),n.setLayerDefinitions(o)}a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:n,title:i}),_(t.groupHeading,t.showGroupHeading,n,e,r,a.options,a.wimOptions)}else if("agisImage"===a.wimOptions.layerType){var n=new s(a.url,a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:n,title:i}),a.visibleLayers&&n.setVisibleLayers(a.visibleLayers),_(t.groupHeading,t.showGroupHeading,n,e,r,a.options,a.wimOptions)}})});var L=new e({map:map,layerInfos:S},"legendDiv");L.startup();var x;x=map.getLayer("huc8"),x.setVisibility(!1)})}),$(document).ready(function(){});