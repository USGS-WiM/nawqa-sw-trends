function addCommas(e){e+="";for(var t=e.split("."),i=t[0],a=t.length>1?"."+t[1]:"",s=/(\d+)(\d{3})/;s.test(i);)i=i.replace(s,"$1,$2");return i+a}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers,renderer;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","esri/renderers/UniqueValueRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","dojo/domReady!"],function(e,t,i,a,s,n){var r=null;renderer=new a(r,"all_pest_trends.trend_int");var o=new n(n.STYLE_SQUARE,15,new s(s.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),l=new n(n.STYLE_SQUARE,10,new s(s.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),c=new n(n.STYLE_SQUARE,5,new s(s.STYLE_SOLID,new esri.Color([255,0,0]),1),new esri.Color([255,0,0,.25])),d=new n(n.STYLE_SQUARE,5,new s(s.STYLE_SOLID,new esri.Color([255,255,255]),1),new esri.Color([0,0,0,.25])),p=new n(n.STYLE_SQUARE,5,new s(s.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25])),u=new n(n.STYLE_SQUARE,10,new s(s.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25])),g=new n(n.STYLE_SQUARE,15,new s(s.STYLE_SOLID,new esri.Color([0,255,0]),1),new esri.Color([0,255,0,.25]));renderer.addValue(3,o),renderer.addValue(2,l),renderer.addValue(1,c),renderer.addValue(0,d),renderer.addValue(-1,p),renderer.addValue(-2,u),renderer.addValue(-3,g),allLayers=[{groupHeading:"sites",showGroupHeading:!1,includeInLayerList:!1,layers:{"pest layer":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites_test/MapServer/0",options:{id:"pestSites",opacity:1,mode:i.MODE_SNAPSHOT,outFields:["*"],defaultDefinitionExpression:"Pesticide = 'Alachlor' AND period = 'P10'",visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"Eco Sites layer":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites_test/MapServer/1",options:{id:"ecoSites",opacity:1,mode:i.MODE_SNAPSHOT,outFields:["*"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"WRTDS Concentration Sites":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites_test/MapServer/2",options:{id:"wrtdsSites",opacity:1,mode:i.MODE_SNAPSHOT,outFields:["wrtds_sites.Station_nm","wrtds_sites.Site_no","wrtds_sites.staAbbrev","wrtds_sites.agency1","wrtds_sites.db_source","wrtds_sites.dec_lat_va","wrtds_sites.dec_long_va","wrtds_sites.drainSqKm","wrtds_sites.huc_cd"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"WRTDS Flux Sites":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites_test/MapServer/3",options:{id:"wrtdsFluxSites",opacity:1,mode:i.MODE_SNAPSHOT,outFields:["wrtds_sites.Station_nm","wrtds_sites.Site_no","wrtds_sites.staAbbrev","wrtds_sites.agency1","wrtds_sites.db_source","wrtds_sites.dec_lat_va","wrtds_sites.dec_long_va","wrtds_sites.drainSqKm","wrtds_sites.huc_cd"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}}}}]});var map,allLayers,maxLegendHeight,maxLegendDivHeight,dragInfoWindows=!0,defaultMapCenter=[-95.6,38.6],constObj;require(["esri/arcgis/utils","esri/Color","esri/map","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/geometry/Point","esri/graphicsUtils","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/tasks/query","esri/geometry/webMercatorUtils","dojo/dnd/Moveable","dojo/query","dojo/dom","dojo/dom-class","dojo/on","dojo/domReady!"],function(e,t,i,a,s,n,r,o,l,c,d,p,u,g,y,m,f,h,v,b,S,w){function L(){var e=$("#pesticideSelect").val(),t=$("input[name=trendPeriod]:checked").val(),i="Pesticide = '"+e+"' AND period = '"+t+"'";map.getLayer("pestSites").setDefinitionExpression(i);var a=map.getLayer("pestSites").graphics,s=w(map.getLayer("pestSites"),"update-end",function(e){if(a.length>0){var t=p.graphicsExtent(a);map.setExtent(t,!0),s.remove()}})}function _(){var e=$("#ecologySelect").val(),t=$("input[name=trendPeriod]:checked").val(),i="";"P10"==t?i="AND (EcoTrendResults_Nyear  = 8 OR EcoTrendResults_Nyear  = 9 OR EcoTrendResults_Nyear  = 10 OR EcoTrendResults_Nyear  = 11)":"P20"==t&&(i="AND (EcoTrendResults_Nyear  = 18 OR EcoTrendResults_Nyear  = 19 OR EcoTrendResults_Nyear  = 20)");var a="EcoTrendResults_y = '"+e+"' "+i;map.getLayer("ecoSites").setDefinitionExpression(a);var s=map.getLayer("ecoSites").graphics,n=w(map.getLayer("ecoSites"),"update-end",function(e){if(s.length>0){var t=p.graphicsExtent(s);map.setExtent(t,!0),n.remove()}})}function T(){1===b.byId("chkExtent").checked?j.activeGeocoder.searchExtent=map.extent:j.activeGeocoder.searchExtent=null}function x(){T();var e=j.find();e.then(function(e){O(e)}),$("#geosearchModal").modal("hide")}function E(e){D();var t=e.graphic?e.graphic:e.result.feature;t.setSymbol(z)}function O(e){if(e=e.results,e.length>0){D();for(var t=0;t<e.length;t++);var i=new d(e[0].feature.geometry);map.centerAndZoom(i,17)}}function D(){map.infoWindow.hide(),map.graphics.clear()}function k(e,t,i,a,s){return new u({angle:0,xoffset:t,yoffset:i,type:"esriPMS",url:e,contentType:"image/png",width:a,height:s})}if(!jQuery.support.cors&&window.XDomainRequest){var q=/^https?:\/\//i,P=/^get|post$/i,R=new RegExp("^"+location.protocol,"i"),I=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(e,t,i){if(e.crossDomain&&e.async&&P.test(e.type)&&q.test(t.url)&&R.test(t.url)){var a=null,s=(t.dataType||"").toLowerCase();return{send:function(i,n){a=new XDomainRequest,/^\d+$/.test(t.timeout)&&(a.timeout=t.timeout),a.ontimeout=function(){n(500,"timeout")},a.onload=function(){var e="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,t={code:200,message:"success"},i={text:a.responseText};try{if("json"===s)try{i.json=JSON.parse(a.responseText)}catch(r){t.code=500,t.message="parseerror"}else if("xml"===s||"text"!==s&&I.test(a.contentType)){var o=new ActiveXObject("Microsoft.XMLDOM");o.async=!0;try{o.loadXML(a.responseText)}catch(r){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw t.code=500,t.message="parseerror","Invalid XML: "+a.responseText;i.xml=o}}catch(l){throw l}finally{n(t.code,t.message,i,e)}},a.onerror=function(){n(500,"error",{text:a.responseText})},a.open(e.type,e.url),a.send()},abort:function(){a&&a.abort()}}}})}jQuery.support.cors=!0,$.ajax({dataType:"json",type:"GET",url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/swTrendSites_test/MapServer/4/query?where=include_in_mapper_+%3D+%27include%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=Model%2CParameter_name&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=json",headers:{Accept:"*/*"},success:function(e){constObj=e,$.each(e.features,function(e,t){null!=t.attributes.Model&&("Ecology kendall"==t.attributes.Model?$("#ecologySelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"SEAWAVE-Q"==t.attributes.Model?$("#pesticideSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)):"WRTDS"==t.attributes.Model&&$("#nutrientsSelect").append($("<option></option>").attr(t.attributes).text(t.attributes.Parameter_name)))}),$("#typeSelect").val("Nutrients"),$("#nutrientsSelect").val("Total Phosphorus"),$("#ecologySelect").val("DiaHighMot"),$("#pesticideSelect").val("Acetochlor")},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),map=i("mapDiv",{basemap:"topo",center:defaultMapCenter,zoom:5});var C=new a({map:map},"homeButton");C.startup();var N=new s({map:map},"locateButton");N.startup(),$("#disclaimerModal").modal("show"),$(window).resize(function(){$("#legendCollapse").hasClass("in")?(maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("height",maxLegendHeight),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)):$("#legendElement").css("height","initial")});var M=["pestSites","ecoSites","wrtdsSites","wrtdsFluxSites"];$("#typeSelect").on("change",function(e){var t=e.currentTarget.value;$(".constSelect").hide(),$.each(M,function(e,t){map.getLayer(t).setVisibility(!1)}),("Pesticides"==t||"Aquatic ecology"==t)&&($("#trend1input").checked||$("#trend2input").checked||$("#trend1input").prop("checked",!0)),"Nutrients"==t?($("#nutrientsSelect").show(),$("#trendTypes").show(),$("#trend4,#trend3").show(),map.getLayer("wrtdsSites").setVisibility(!0)):"Pesticides"==t?($("#pesticideSelect").show(),$("#trendTypes").show(),$("#trend4,#trend3").hide(),L(),map.getLayer("pestSites").setVisibility(!0)):"Aquatic ecology"==t&&($("#ecologySelect").show(),$("#trendTypes").hide(),$("#trend4,#trend3").hide(),_(),map.getLayer("ecoSites").setVisibility(!0))}),$("#pesticideSelect").on("change",function(e){var t=e.currentTarget.value,i=$("input[name=trendPeriod]:checked").val(),a="Pesticide = '"+t+"' AND period = '"+i+"'";map.getLayer("pestSites").setDefinitionExpression(a);var s=map.getLayer("pestSites").graphics,n=w(map.getLayer("pestSites"),"update-end",function(e){if(s.length>0){var t=p.graphicsExtent(s);map.setExtent(t,!0),n.remove()}})}),$("#ecologySelect").on("change",function(e){var t=e.currentTarget.value,i=$("input[name=trendPeriod]:checked").val(),a="";"P10"==i?a="AND (EcoTrendResults_Nyear  = 8 OR EcoTrendResults_Nyear  = 9 OR EcoTrendResults_Nyear  = 10 OR EcoTrendResults_Nyear  = 11)":"P20"==i&&(a="AND (EcoTrendResults_Nyear  = 18 OR EcoTrendResults_Nyear  = 19 OR EcoTrendResults_Nyear  = 20)");var s="EcoTrendResults_y = '"+t+"' "+a;map.getLayer("ecoSites").setDefinitionExpression(s);var n=map.getLayer("ecoSites").graphics,r=w(map.getLayer("ecoSites"),"update-end",function(e){if(n.length>0){var t=p.graphicsExtent(n);map.setExtent(t,!0),r.remove()}})}),$("#nutrientsSelect").on("change",function(e){var t,i=e.currentTarget.value,a=$("input[name=trendType]:checked").val();"concentration"==a?(t=map.getLayer("wrtdsSites"),t.setVisibility(!0),map.getLayer("wrtdsFluxSites")):"load"==a&&(t=map.getLayer("wrtdsFluxSites"),t.setVisibility(!0),map.getLayer("wrtdsSites"));var s=$("input[name=trendPeriod]:checked").val(),n="";"P10"==s?n="2002":"P20"==s?n="1992":"P30"==s?n="1982":"P40"==s&&(n="1972");var r="wrtds_trends_wm.id_unique LIKE '%"+i+"%"+n+"'";t.setDefinitionExpression(r);var o=t.graphics,l=w(t,"update-end",function(e){if(o.length>0){var t=p.graphicsExtent(o);map.setExtent(t,!0),l.remove()}})}),$(".trendPeriod").on("change",function(e){var t=e.currentTarget.value;if("Pesticides"==$("#typeSelect")[0].value){var i=$("#pesticideSelect").val(),a="Pesticide = '"+i+"' AND period = '"+t+"'",s=w(map.getLayer("pestSites"),"update-end",function(e){var t=p.graphicsExtent(map.getLayer("pestSites").graphics);map.setExtent(t,!0),s.remove()});map.getLayer("pestSites").setDefinitionExpression(a)}else if("Aquatic ecology"==$("#typeSelect")[0].value){var n="";"P10"==t?n="AND (EcoTrendResults_Nyear  = 8 OR EcoTrendResults_Nyear  = 9 OR EcoTrendResults_Nyear  = 10 OR EcoTrendResults_Nyear  = 11)":"P20"==t&&(n="AND (EcoTrendResults_Nyear  = 18 OR EcoTrendResults_Nyear  = 19 OR EcoTrendResults_Nyear  = 20)");var i=$("#ecologySelect").val(),a="EcoTrendResults_y = '"+i+"' "+n,s=w(map.getLayer("ecoSites"),"update-end",function(e){var t=p.graphicsExtent(map.getLayer("ecoSites").graphics);map.setExtent(t,!0),s.remove()});map.getLayer("ecoSites").setDefinitionExpression(a)}else if("Nutrients"==$("#typeSelect")[0].value){var r,o=$("input[name=trendType]:checked").val();"concentration"==o?(r=map.getLayer("wrtdsSites"),r.setVisibility(!0),map.getLayer("wrtdsFluxSites")):"load"==o&&(r=map.getLayer("wrtdsFluxSites"),r.setVisibility(!0),map.getLayer("wrtdsSites"));var n="";"P10"==t?n="2002":"P20"==t?n="1992":"P30"==t?n="1982":"P40"==t&&(n="1972");var i=$("#nutrientsSelect").val(),a="wrtds_trends_wm.id_unique LIKE '%"+i+"%"+n+"'";r.setDefinitionExpression(a);var l=r.graphics,s=w(r,"update-end",function(e){if(l.length>0){var t=p.graphicsExtent(l);map.setExtent(t,!0),s.remove()}})}}),$(".trendType").on("change",function(e){var t=e.currentTarget.value;if("Pesticides"==$("#typeSelect")[0].value);else if("Aquatic ecology"==$("#typeSelect")[0].value);else if("Nutrients"==$("#typeSelect")[0].value){var i;$.each(M,function(e,t){map.getLayer(t).setVisibility(!1)}),"concentration"==t?i=map.getLayer("wrtdsSites"):"load"==t&&(i=map.getLayer("wrtdsFluxSites"));var a="",s=$("input[name=trendPeriod]:checked").val();"P10"==s?a="2002":"P20"==s?a="1992":"P30"==s?a="1982":"P40"==s&&(a="1972");var n=$("#nutrientsSelect").val(),r="wrtds_trends_wm.id_unique LIKE '%"+n+"%"+a+"'",o=i.graphics,l=w(i,"update-end",function(e){if(o.length>0){var t=p.graphicsExtent(o);map.setExtent(t,!0),l.remove()}});i.setDefinitionExpression(r),i.setVisibility(!0)}}),w(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var t=f.webMercatorToGeographic(map.extent.getCenter());if($("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3)),1==dragInfoWindows){var i=v(".title",map.infoWindow.domNode)[0],a=new h(map.infoWindow.domNode,{handle:i});w(a,"FirstMove",function(){var e=v(".outerPointer",map.infoWindow.domNode)[0];S.add(e,"hidden");var e=v(".pointer",map.infoWindow.domNode)[0];S.add(e,"hidden")}.bind(this))}}),w(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),w(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var t=f.webMercatorToGeographic(e.mapPoint);$("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3))}}),w(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=f.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var A=new n("http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");w(b.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(A)}),w(b.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(A)}),w(b.byId("btnHybrid"),"click",function(){map.setBasemap("hybrid"),map.removeLayer(A)}),w(b.byId("btnTerrain"),"click",function(){map.setBasemap("terrain"),map.removeLayer(A)}),w(b.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(A)}),w(b.byId("btnNatGeo"),"click",function(){map.setBasemap("national-geographic"),map.removeLayer(A)}),w(b.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(A)}),w(b.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(A)}),w(b.byId("btnNatlMap"),"click",function(){map.addLayer(A)}),w(map,"click",function(e){}),$("#siteInfoDiv").lobiPanel({unpin:!1,reload:!1,minimize:!1,close:!1,expand:!1,editTitle:!1,maxWidth:800,maxHeight:500}),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoClose' title='close'><b>X</b></div>"),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoMin' title='collapse'><b>_</b></div>"),$("#siteInfoMin").click(function(){$("#siteInfoDiv").css("visibility","hidden")}),$("#siteInfoClose").click(function(){$("#siteInfoDiv").css("visibility","hidden")}),map.on("layer-add",function(e){var i=e.layer.id;e.layer;if("pestSites"==i||"wrtdsSites"==i||"ecoSites"==i||"wrtdsFluxSites"==i){if("wrtdsSites"==i){var a=map.getLayer("wrtdsSites").graphics,s=w(map.getLayer("wrtdsSites"),"update-end",function(e){if(a.length>0){var t=p.graphicsExtent(a);map.setExtent(t,!0),s.remove()}});map.getLayer("wrtdsSites").setDefinitionExpression("wrtds_trends_wm.id_unique LIKE '%Total Phosphorus%2002'"),map.getLayer("wrtdsSites").setVisibility(!0)}map.getLayer(i).on("click",function(e){map.graphics.clear();var a=new g(g.STYLE_SOLID,new y(y.STYLE_DASHDOT,new t([255,0,0]),2),new t([255,255,0,.25]));map.graphics.add(new l(e.mapPoint,a)),$("#siteInfoDiv").css("visibility","visible");var s=$("#siteInfoDiv").data("lobiPanel"),n=$(document).height(),r=$(document).width(),o=.9,c=n*o,d=r*o;500>n&&$("#siteInfoDiv").height(c),500>r&&$("#siteInfoDiv").width(d);var p=e.x,u=e.y;s.setPosition(p,u),1==s.isPinned()&&s.unpin();var m=e.graphic.attributes;$("#siteInfoTabPane").empty(),"ecoSites"==i?$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+m.EcoSiteSummary_no_headers_csv_Ecology_site_name+"<br/><b>Site number: </b>"+m.EcoSiteSummary_no_headers_csv_Ecology_site_ID+"<br/><b>Latitude: </b>"+m.EcoSiteSummary_no_headers_csv_LatDD+"<br/><b>Longitude: </b>"+m.EcoSiteSummary_no_headers_csv_LngDD+"<br/>"):"pestSites"==i?$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+m["all_pest_trends_wm.Site"]+"<br/><b>Site number: </b>"+m["all_pest_trends_wm.pstaid"]+"<br/><b>Agency: </b>"+m["pest10yrsites.agency"]+"<br/><b>Latitude: </b>"+m["pest10yrsites.LAT"]+"<br/><b>Longitude: </b>"+m["pest10yrsites.LONG_"]+"<br/><b>Drainage area: </b>"+m["pest10yrsites.DA"]+"<br/>"):("wrtdsSites"==i||"wrtdsFluxSites"==i)&&$("#siteInfoTabPane").append("<br/><b>Site name: </b>"+m["wrtds_sites.Station_nm"]+"<br/><b>Site number: </b>"+m["wrtds_sites.Site_no"]+"<br/><b>State: </b>"+m["wrtds_sites.staAbbrev"]+"<br/><b>Agency: </b>"+m["wrtds_sites.agency1"]+"<br/><b>Data source: </b>"+m["wrtds_sites.db_source"]+"<br/><b>Latitude: </b>"+m["wrtds_sites.dec_lat_va"]+"<br/><b>Longitude: </b>"+m["wrtds_sites.dec_long_va"]+"<br/><b>Drainage area: </b>"+m["wrtds_sites.drainSqKm"]+"<br/><b>HUC8: </b>"+m["wrtds_sites.huc_cd"]+"<br/>")})}("wrtdsSites"==i||"wrtdsFluxSites"==i)&&map.getLayer(i).on("query-limit-exceeded",function(e){alert("exceeded")})});var j=new r({value:"",maxLocations:25,autoComplete:!0,arcgisGeocoder:!0,autoNavigate:!1,map:map},"geosearch");j.startup(),j.on("select",E),j.on("findResults",O),j.on("clear",D),w(j.inputNode,"keydown",function(e){13==e.keyCode&&T()});var z=k("../images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),w(b.byId("btnGeosearch"),"click",x),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}function i(){$("#chartModal").modal("show")}function a(){$("#tableModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$("#userGuideNav").click(function(){$("#userGuideModal").modal("show")}),$("#faqNav").click(function(){$("#faqModal").modal("show")}),$("#learnMoreButton").click(function(){$("#learnMoreModal").modal("show")}),$("#charts").click(function(){i()}),$("#table").click(function(){a()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")}),$("#faq1header").click(function(){$("#faq1body").slideToggle(250)}),$("#faq2header").click(function(){$("#faq2body").slideToggle(250)}),$("#faq3header").click(function(){$("#faq3body").slideToggle(250)}),$("#faq4header").click(function(){$("#faq4body").slideToggle(250)}),$("#faq5header").click(function(){$("#faq5body").slideToggle(250)}),$("#faq6header").click(function(){$("#faq6body").slideToggle(250)}),$("#faq7header").click(function(){$("#faq7body").slideToggle(250)}),$("#faq8header").click(function(){$("#faq8body").slideToggle(250)}),$("#faq9header").click(function(){$("#faq9body").slideToggle(250)}),$("#faq10header").click(function(){$("#faq10body").slideToggle(250)}),$("#faq11header").click(function(){$("#faq511ody").slideToggle(250)}),$("#faq12header").click(function(){$("#faq5b12dy").slideToggle(250)}),$("#faq13header").click(function(){$("#faq5bo13y").slideToggle(250)})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/SpatialReference","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","dijit/form/CheckBox","dijit/form/RadioButton","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on"],function(e,t,i,a,s,n,r,o,l,c,d,p,u,g,y,m,f,h,v,b){function S(e,t,i,a,s,n,r){if(map.addLayer(i),L.push([s,camelize(a),i]),s){if(!$("#"+camelize(s)).length){var o;if("Data Source"==s)var o=$('<div id="'+camelize(s+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+s+'<span id="info'+camelize(s)+'" title="Data Source identifies the scale, year and emulsion of the imagery that was used to map the wetlands and riparian areas for a given area. It also identifies areas that have Scalable data, which is an interim data product in areas of the nation where standard compliant wetland data is not yet available. Click for more info on Scalable data." class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(s)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button> </div>');else var o=$('<div id="'+camelize(s+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+s+"</button> </div>");o.click(function(e){o.find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$.each(L,function(e,t){var i=map.getLayer(t[2].id);if(t[0]==s)if($("#"+t[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&o.find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",t[1]),map.addLayer(t[2]);var i=map.getLayer(t[2].id);i.setVisibility(!0)}else if(o.find("i.glyphspan").hasClass("fa-square-o")){console.log("removing layer: ",t[1]);var i=map.getLayer(t[2].id);i.setVisibility(!1)}})});var l=$('<div id="'+camelize(s)+'" class="btn-group-vertical" data-toggle="buttons"></div>');$("#toggle").append(l),console.log("here")}if(i.visible)var c=$('<div id="'+camelize(a)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(s)+'" autocomplete="off"><i class="glyphspan fa fa-dot-circle-o '+camelize(s)+'"></i>&nbsp;&nbsp;'+a+"</label> </div>");else var c=$('<div id="'+camelize(a)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(s)+'" autocomplete="off"><i class="glyphspan fa fa-circle-o '+camelize(s)+'"></i>&nbsp;&nbsp;'+a+"</label> </div>");$("#"+camelize(s)).append(c),c.click(function(e){if($(this).find("i.glyphspan").hasClass("fa-circle-o")){$(this).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o");var t=$(this)[0].id;$.each(L,function(e,i){if(i[0]==s)if(i[1]==t&&$("#"+camelize(s+" Root")).find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",i[1]),map.addLayer(i[2]);var a=map.getLayer(i[2].id);a.setVisibility(!0)}else if(i[1]==t&&$("#"+camelize(s+" Root")).find("i.glyphspan").hasClass("fa-square-o"))console.log("group heading not checked");else{console.log("removing layer: ",i[1]);var a=map.getLayer(i[2].id);a.setVisibility(!1),$("#"+i[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&$("#"+i[1]).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o")}})}})}else if(r.includeInLayerList){if(i.visible&&void 0!==r.hasOpacitySlider&&1==r.hasOpacitySlider&&void 0!==r.moreinfo&&r.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+a+'<span id="info'+camelize(a)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(a)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(!i.visible&&void 0!==r.hasOpacitySlider&&1==r.hasOpacitySlider&&void 0!==r.moreinfo&&r.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+a+'<span id="info'+camelize(a)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(a)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(i.visible&&void 0!==r.hasOpacitySlider&&1==r.hasOpacitySlider)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+a+'<span id="info'+camelize(a)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(i.visible||void 0===r.hasOpacitySlider||1!=r.hasOpacitySlider)if(i.visible&&void 0!==r.moreinfo&&r.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+a+'<span id="opacity'+camelize(a)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');else if(!i.visible&&void 0!==r.moreinfo&&r.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+a+'<span id="info'+camelize(a)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(i.visible)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+a+"</button></span></div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+a+"</button> </div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+a+'<span id="opacity'+camelize(a)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');c.click(function(e){$(this).find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$(this).find("button").button("toggle"),i.visible?i.setVisibility(!1):i.setVisibility(!0),r.otherLayersToggled&&$.each(r.otherLayersToggled,function(e,t){var a=map.getLayer(t);a.setVisibility(i.visible)})})}if(void 0!==t){var d=camelize(e);if(!$("#"+d).length){if(t)var p=$('<div id="'+d+'"><div class="alert alert-info" role="alert"><strong>'+e+"</strong></div></div>");else var p=$('<div id="'+d+'"></div>');$("#toggle").append(p)}if(s){if($("#"+d).prepend(o),$("#"+d).prepend(l),void 0!==r.moreinfo&&r.moreinfo){var u="#info"+camelize(s),g=$(u);g.click(function(e){window.open(r.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}if($("#opacity"+camelize(s)).length>0){var u="#opacity"+camelize(s),y=$(u);y.click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var t=map.getLayer(n.id).opacity,i=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+t+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(i),$("#slider")[0].value=100*t,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(n.id).setOpacity(t),r.otherLayersToggled&&$.each(r.otherLayersToggled,function(e,i){var a=map.getLayer(i);a.setOpacity(t)})})})}}else{if($("#"+d).append(c),void 0!==r.moreinfo&&r.moreinfo){var u="#info"+camelize(a),g=$(u);g.click(function(e){window.open(r.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}$("#opacity"+camelize(a)).length>0&&$("#opacity"+camelize(a)).click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var t=map.getLayer(n.id).opacity,i=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+t+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(i),$("#slider")[0].value=100*t,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(n.id).setOpacity(t),r.otherLayersToggled&&$.each(r.otherLayersToggled,function(e,i){var a=map.getLayer(i);a.setOpacity(t)})})})}}else if($("#toggle").append(c),void 0!==r.moreinfo&&r.moreinfo){var u="#info"+camelize(a),g=$(u);g.click(function(e){alert(e.currentTarget.id),e.preventDefault(),e.stopPropagation()})}}var w=[],L=[];$.each(allLayers,function(e,t){console.log("processing: ",t.groupHeading),$.each(t.layers,function(e,i){var a="";if(i.wimOptions.exclusiveGroupName&&(a=i.wimOptions.exclusiveGroupName),"agisFeature"===i.wimOptions.layerType){var s=new l(i.url,i.options);void 0!==i.wimOptions.renderer&&s.setRenderer(i.wimOptions.renderer),i.wimOptions&&1==i.wimOptions.includeLegend&&w.unshift({layer:s,title:e}),S(t.groupHeading,t.showGroupHeading,s,e,a,i.options,i.wimOptions)}else if("agisWMS"===i.wimOptions.layerType){
var s=new d(i.url,{resourceInfo:i.options.resourceInfo,visibleLayers:i.options.visibleLayers},i.options);i.wimOptions&&1==i.wimOptions.includeLegend&&w.unshift({layer:s,title:e}),S(t.groupHeading,t.showGroupHeading,s,e,a,i.options,i.wimOptions)}else if("agisDynamic"===i.wimOptions.layerType){var s=new o(i.url,i.options);if(i.visibleLayers&&s.setVisibleLayers(i.visibleLayers),i.wimOptions&&i.wimOptions.layerDefinitions){var n=[];$.each(i.wimOptions.layerDefinitions,function(e,t){n[e]=t}),s.setLayerDefinitions(n)}i.wimOptions&&1==i.wimOptions.includeLegend&&w.unshift({layer:s,title:e}),S(t.groupHeading,t.showGroupHeading,s,e,a,i.options,i.wimOptions)}else if("agisImage"===i.wimOptions.layerType){var s=new ArcGISImageServiceLayer(i.url,i.options);i.wimOptions&&1==i.wimOptions.includeLegend&&w.unshift({layer:s,title:e}),i.visibleLayers&&s.setVisibleLayers(i.visibleLayers),S(t.groupHeading,t.showGroupHeading,s,e,a,i.options,i.wimOptions)}})});var _=new e({map:map,layerInfos:w},"legendDiv");_.startup()})}),$(document).ready(function(){});